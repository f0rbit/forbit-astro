---
import moment from 'moment'
import type { Experience } from '../../assets/experience'
import { formatDuration } from '../../utils'
import SkillEvents from '../about/SkillEvents.astro'
import AwardTypeIcon from '../projects/AwardTypeIcon.astro'
import { Badge, Clamp } from "@f0rbit/ui"
interface Props {
    experience: Experience & { id: string }
    type: 'left' | 'right' | 'normal'
    tags: boolean
}

const { experience, type, tags } = Astro.props

const date_string = `${moment(experience.start_date).calendar()} - ${experience.end_date ? moment(experience.end_date).calendar() : 'Present'}`
const duration = experience.end_date ? moment.duration(moment(experience.end_date).diff(experience.start_date)) : moment.duration(moment().diff(experience.start_date))
const { title, awards } = experience
---

<div class={`stack stack-sm experience-card ${['left', 'right'].includes(type) ? 'experience-card--timeline' : ''} ${type == 'left' ? 'experience-card--left' : ''}`}>
    <div
        class={`experience-dot 
            ${type == 'normal' ? 'experience-dot--normal' : ''} 
            ${type == 'right' ? 'experience-dot--right' : ''} 
            ${type == 'left' ? 'experience-dot--left' : ''}
        `}
    >
    </div>
    <div class="stack stack-sm">
        <label class="text-sm experience-label">
            <span>{date_string}</span>
            {duration && <span class="text-subtle"> ({formatDuration(duration)})</span>}
        </label>
        <div class={`experience-title ${type == 'left' ? 'experience-title--reverse' : ''}`}>
            <h3 id={experience.id}>{title}</h3>
            {tags && <Badge variant="accent"><span style="text-transform: capitalize;">{experience.type}</span></Badge>}
        </div>
        {experience.company && <div class="text-xs text-subtle" style="margin-top: -0.25rem;">{experience.company}</div>}
    </div>
    <div class={`stack stack-sm ${type == 'left' ? 'experience-body--left' : 'experience-body--right'}`}>
        <Clamp client:load lines={2} showMoreText="Read More" showLessText="Read Less">
            <p class="text-muted">{experience.description}</p>
        </Clamp>
        <div class={`cluster experience-awards ${type == 'left' ? 'experience-awards--left' : ''}`}>
            {
                awards.map((award) => (
                    <Badge title={award.description}>
                        <AwardTypeIcon type={award.type} size={20} />
                        <span>{award.title}</span>
                    </Badge>
                ))
            }
            {experience.skills.map((event) => <SkillEvents event={event} />)}
        </div>
    </div>
</div>

<style>
  .experience-card {
    position: relative;
  }
  .experience-card--timeline {
    min-height: 10rem;
  }
  .experience-card--left {
    align-items: flex-end;
    text-align: right;
  }
  .experience-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: var(--fg-muted);
    position: absolute;
  }
  .experience-dot--normal {
    left: -16.5px;
    top: 6px;
  }
  .experience-dot--right {
    top: 6px;
    left: -23.5px;
  }
  .experience-dot--left {
    top: 6px;
    right: -23.5px;
  }
  .experience-label {
    margin-bottom: -0.25rem;
  }
  .experience-title {
    display: flex;
    flex-direction: row;
    align-items: center;
    gap: 0.5rem;
  }
  .experience-title--reverse {
    flex-direction: row-reverse;
  }
  .experience-body--left {
    padding-right: var(--space-md);
  }
  .experience-body--right {
    padding-left: var(--space-md);
  }
  .experience-awards {
    align-items: center;
  }
  .experience-awards--left {
    justify-content: flex-end;
  }
</style>
